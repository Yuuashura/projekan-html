<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pustaka Komik - MoonKomik</title>
    <link rel="stylesheet" href="../css/header-footer.css" />
    <link rel="icon" href="https://github.com/Yuuashura/icon-pack/blob/main/4.gif?raw=true"/>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            --dark-navy: #0a192f;
            --navy: #112240;
            --light-navy: #233554;
            --lightest-navy: #303c55;
            --slate: #8892b0;
            --light-slate: #a8b2d1;
            --lightest-slate: #ccd6f6;
            --white: #e6f1ff;
            --accent: #64ffda;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: var(--font-sans);
            /* background-color: var(--dark-navy); */
            color: var(--light-slate);
        }
        body{
  background-image: url("../assets/raiden.png") !important;
  background-position:center ;
  /* background-repeat: no-repeat; */
}

body::after{
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(10, 25, 47, 0.9);
  backdrop-filter: blur(5px);
  z-index: -1;
}
        main {
            padding: 20px 0;
            min-height: 80vh;
        }
        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
        }
        .container h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--white);
            font-size: 2.5rem;
        }
        .filter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            background-color: var(--navy);
            padding: 20px;
            border-radius: 8px;
            flex-wrap: wrap;
        }
        .filter-container label {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--lightest-slate);
        }
        #genre-select {
            font-size: 1rem;
            padding: 10px 15px;
            background-color: var(--light-navy);
            color: var(--lightest-slate);
            border: 1px solid var(--lightest-navy);
            border-radius: 5px;
            min-width: 250px;
            cursor: pointer;
        }
        #genre-select:focus {
            outline: none;
            border-color: var(--accent);
        }
        .comic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            min-height: 300px;
        }
        .card-link {
            text-decoration: none;
            color: inherit;
        }
        .card {
            background-color: var(--navy);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: 0.3s ease;
            animation: inAnimation 0.5s ease-in-out;
        }
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(13, 247, 255, 0.279);
        }
        .card-thumbnail {
            height: 180px;
            position: relative;
        }
        .card-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .card-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--accent);
            color: var(--dark-navy);
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 700;
        }
        .card-content {
            padding: 15px;
            display: flex;
            flex-direction: column;
            flex-grow: 1; 
        }
        .card-content h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--white);
            margin: 0 0 10px 0;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .card-description {
            font-size: 0.9rem;
            color: var(--slate);
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .card-info {
            font-size: 0.8rem;
            color: var(--light-slate);
            margin-bottom: 15px;
        }
        .card-chapters {
            margin-top: auto;
            border-top: 1px solid var(--light-navy);
            padding-top: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        .card-chapters a {
            color: var(--accent);
            font-weight: 500;
        }
        .status-message {
            text-align: center;
            font-size: 1.2rem;
            padding: 50px;
            color: var(--slate);
            grid-column: 1 / -1;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 20px;
            margin-top: 40px;
        }
        .page-btn {
            background-color: var(--accent);
            color: var(--dark-navy);
            border: none;
            padding: 10px 25px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        .page-btn:hover:not(:disabled) {
            opacity: 0.8;
        }
        .page-btn:disabled {
            background-color: var(--lightest-navy);
            color: var(--slate);
            cursor: not-allowed;
        }
        .page-info {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--lightest-slate);
        }

        @media (max-width: 480px){
            .pagination-container{
                font-size: 0.4rem;
            }

            .page-btn{
                font-size: 0.9rem;
                padding: 6px 15px;
            }
        }


    </style>
</head>
<body>
    <header>
      <a href="../"
        ><i
          ><h1 class="judul">Mona<span>Komik</span></h1></i></a
      >

      <!-- Desktop Navigation -->
      <div class="nav">
        <a href="../"><p>Home</p></a>
        <a href="pustaka.html" class="home"><p>Genre List</p></a>
        <a href="all-komik.html"><p>All Comic</p></a>
        <a href="login.html"><p>Masuk</p></a>
        <a href="register.html"><p>Daftar</p></a>
        <a href="tentang.html"><p>Tentang</p></a>
        
      </div>

      <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Search Bar -->

        <form class="cari" id="searchForm">
        <input type="text" placeholder="search" id="searchInput"/>
        <button type="submit"><img src="../assets/search.png" alt="Search"/></a>
      </form>
    </header>

    <div class="mobile-nav-overlay" id="mobileNavOverlay">
      <button class="mobile-nav-close" id="mobileNavClose">&times;</button>
      <div class="nav">
        <a href="../"><p>Home</p></a>
        <a href="pustaka.html" class="home"><p>Genre List</p></a>
        <a href="all-komik.html"><p>All Comic</p></a>
        <a href="login.html"><p>Masuk</p></a>
        <a href="register.html"><p>Daftar</p></a>
        <a href="tentang.html"><p>Tentang</p></a>
      </div>
    </div>



    <main>
        <div class="container">
            <h1>Pustaka Komik</h1>
            <div class="filter-container">
                <label for="genre-select">Filter berdasarkan Genre:</label>
                <select name="genre" id="genre-select">
                    <option value="" id="default-option">Memuat genre...</option>
                </select>
            </div>
            <div id="comic-container" class="comic-grid">
                <!-- Hasil komik akan ditampilkan di sini -->
            </div>
            <div id="pagination-controls" class="pagination-container" style="display: none;">
                <button id="prev-page-btn" class="page-btn">‹ Sebelumnya</button>
                <span id="page-info" class="page-info">Halaman 1</span>
                <button id="next-page-btn" class="page-btn">Berikutnya ›</button>
            </div>
        </div>
    </main>

    <footer>
      <div class="medsos">
        <a href="https://instagram.com/yudis.ashura" target="_blank"
        ><span><img src="../icon/instagram.png" alt="" /></span
        ></a>
      </div>
      <div class="medsos">
        <a href="https://github.com/yuuashura" target="_blank"
          ><span><img src="../icon/github.png" alt="" /></span
        ></a>
      </div>
      <div class="medsos">
        <a href="https://facebook.com/4sa.cyber" target="_blank"
          ><span><img src="../icon/facebook.png" alt="" /></span
        ></a>
      </div>
      <div class="medsos">
        <a href="https://telegram.com/#" target="_blank"
          ><span><img src="../icon/telegram.png" alt="" /></span
        ></a>
      </div>

      <div class="text-footer">
        <p>
          All the comics on this website are only previews of the original
          comics,there may be many language errors, character names, and story
          lines. For the original version, please buy the comic if it's
          available in your city.
        </p>
        <br />
        <hr />
        <p>&copy; MoonKomik</p>
      </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const genreSelect = document.getElementById('genre-select');
            const comicContainer = document.getElementById('comic-container');
            const paginationControls = document.getElementById('pagination-controls');
            const prevButton = document.getElementById('prev-page-btn');
            const nextButton = document.getElementById('next-page-btn');
            const pageInfo = document.getElementById('page-info');
            
            const baseApi = 'https://yuuashura-api.vercel.app';
            let allGenres = [];

            // --- FUNGSI BARU UNTUK MENAMPILKAN KARTU YANG LEBIH LENGKAP ---
            function displayComics(comics) {
                // comicContainer.removeChild(document.querySelector('.loader'));
                comicContainer.textContent = '';
                if (!comics || comics.length === 0) {
                    const pesanAwal = document.createElement('p');
                    pesanAwal.textContent = 'Tidak komik yang ditemukan';
                    pesanAwal.classList.add('status-message');
                    comicContainer.appendChild(pesanAwal);
                    return;
                }
                comics.forEach(comic => {
                    const cardLink = document.createElement('a');
                    cardLink.className = 'card-link';
                    cardLink.href = `detail-komik.html?${comic.apiMangaLink}`;
                    // card.style.animationDelay = "0.2s";
                    
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    const thumbnailDiv = document.createElement('div');
                    thumbnailDiv.className = 'card-thumbnail';
                    const thumbnailImg = document.createElement('img');
                    thumbnailImg.src = comic.thumbnail;
                    thumbnailImg.alt = `Sampul ${comic.title}`;
                    thumbnailImg.loading = 'lazy'; 
                    const typeBadge = document.createElement('span');
                    typeBadge.className = 'card-badge';
                    typeBadge.textContent = comic.type;
                    thumbnailDiv.appendChild(thumbnailImg);
                    thumbnailDiv.appendChild(typeBadge);
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'card-content';
                    const titleH3 = document.createElement('h3');
                    titleH3.textContent = comic.title;
                    const descriptionP = document.createElement('p');
                    descriptionP.className = 'card-description';
                    descriptionP.textContent = comic.description;
                    const genreP = document.createElement('p');
                    genreP.className = 'card-info';
                    const genreStrong = document.createElement('strong');
                    genreStrong.textContent = 'Genre: ';
                    genreP.appendChild(genreStrong);
                    genreP.appendChild(document.createTextNode(comic.genre));
                    const additionalInfoP = document.createElement('p');
                    additionalInfoP.className = 'card-info';
                    const infoStrong = document.createElement('strong');
                    infoStrong.textContent = 'Info: ';
                    additionalInfoP.appendChild(infoStrong);
                    additionalInfoP.appendChild(document.createTextNode(comic.additionalInfo));
                    const updateStatusP = document.createElement('p');
                    updateStatusP.className = 'card-info';
                    const updateStrong = document.createElement('strong');
                    updateStrong.textContent = 'Update: ';
                    updateStatusP.appendChild(updateStrong);
                    updateStatusP.appendChild(document.createTextNode(comic.updateStatus));
                    const chaptersDiv = document.createElement('div');
                    chaptersDiv.className = 'card-chapters';
                    const firstChapterLink = document.createElement('a');
                    firstChapterLink.href = `#${comic.chapters.first.apiLink}`;
                    firstChapterLink.textContent = `Awal: ${comic.chapters.first.chapter}`;
                    const latestChapterLink = document.createElement('a');
                    latestChapterLink.href = `#${comic.chapters.latest.apiLink}`;
                    latestChapterLink.textContent = `Terbaru: ${comic.chapters.latest.chapter}`;
                    chaptersDiv.appendChild(firstChapterLink);
                    chaptersDiv.appendChild(latestChapterLink);
                    contentDiv.appendChild(titleH3);
                    contentDiv.appendChild(descriptionP);
                    contentDiv.appendChild(genreP);
                    contentDiv.appendChild(additionalInfoP);
                    contentDiv.appendChild(updateStatusP);
                    contentDiv.appendChild(chaptersDiv);
                    cardDiv.appendChild(thumbnailDiv);
                    cardDiv.appendChild(contentDiv);
                    cardLink.appendChild(cardDiv);
                    comicContainer.appendChild(cardLink);
                });
            }

            async function fetchComics(genre, page) {
                comicContainer.textContent = '';
                const loader = document.createElement('div');
                loader.classList.add("loader");
                comicContainer.appendChild(loader);
                paginationControls.style.display = 'flex';
                const url = `${baseApi}/genre/${genre}/${page}`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('Gagal mengambil data komik');
                    
                    const jsonData = await response.json();
                    displayComics(jsonData.data);
                    updatePagination(page, jsonData.hasNextPage);

                } catch (error) {
                    console.error("Error fetching comics:", error);
                    comicContainer.textContent = '';
                    const pesanAwal = document.createElement('p');
                    pesanAwal.textContent = 'Gagal Memuat Data Komik';
                    pesanAwal.classList.add('status-message');
                    comicContainer.appendChild(pesanAwal);

                    paginationControls.style.display = 'none';
                }
            }

            function updatePagination(currentPage, hasNextPage) {
                pageInfo.textContent = `Halaman ${currentPage}`;
                prevButton.disabled = currentPage <= 1;
                nextButton.disabled = !hasNextPage;
            }

            function updateURL(genre, page) {
                const newUrl = `pustaka.html?genre=${genre}&page=${page}`;
                window.history.pushState({ path: newUrl }, '', newUrl);
            }

            async function handlePageLoad() {
                await fetchAllGenres();

                const params = new URLSearchParams(window.location.search);
                const genre = params.get('genre');
                const page = parseInt(params.get('page')) || 1;

                populateGenreFilter(genre);

                if (genre) {
                    fetchComics(genre, page);
                } else {
                    const pesanAwal = document.createElement('p');
                    pesanAwal.textContent = 'Pilih genre terlebih dahulu';
                    pesanAwal.classList.add('status-message');
                    comicContainer.appendChild(pesanAwal);
                    paginationControls.style.display = 'none';
                }
            }

            async function fetchAllGenres() {
                try {
                    const response = await fetch(`${baseApi}/genre-all`);
                    if(!response.ok) throw new Error('Gagal mengambil daftar genre');
                    allGenres = await response.json();
                } catch (error) {
                    console.error("Error fetching genres:", error);
                    const failedSelect = document.createElement('option');
                    failedSelect.value = "";
                    failedSelect.textContent = "Gagal memuat genre";
                    genreSelect.appendChild(failedSelect);
                }
            }

            function populateGenreFilter(selectedGenre) {
                genreSelect.removeChild(document.querySelector('#default-option'));
                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "Pilih Genre";
                genreSelect.appendChild(defaultOption);

                allGenres.forEach(genre => {
                    const option = document.createElement('option');
                    option.value = genre.slug;
                    option.textContent = genre.title;
                    if (genre.slug === selectedGenre) {
                        option.selected = 1; //turen on yg sedang di pilih
                    }
                    genreSelect.appendChild(option);
                });
            }
            
            genreSelect.addEventListener('change', (event) => {
                const selectedGenre = event.target.value;
                if (selectedGenre) {
                    updateURL(selectedGenre, 1);
                    fetchComics(selectedGenre, 1);
                }
            });

            nextButton.addEventListener('click', () => {
                const params = new URLSearchParams(window.location.search);
                const genre = params.get('genre');
                let page = parseInt(params.get('page')) || 1;
                page++;
                updateURL(genre, page);
                fetchComics(genre, page);
            });

            prevButton.addEventListener('click', () => {
                const params = new URLSearchParams(window.location.search);
                const genre = params.get('genre');
                let page = parseInt(params.get('page')) || 1;
                if (page > 1) {
                    page--;
                    updateURL(genre, page);
                    fetchComics(genre, page);
                }
            });





            // ===================  SEARCH  ====================
            const form = document.querySelector('.cari');
            form.addEventListener('submit', function(event) {
            event.preventDefault();
            lakukanPencarian(); 
            });
            function lakukanPencarian() {
            const kataKunci = document.getElementById('searchInput').value.trim();
            window.location.href = `search.html?q=${encodeURIComponent(kataKunci)}`;
            console.log('Kata kunci pencarian:', kataKunci);
            }
            //=====================================================================

            
            //======================================================================
            // RESPONSIFE MOBILE 
            //=====================================================================
            function initMobileNavigation() {
                const mobileMenuToggle = document.getElementById('mobileMenuToggle');
                const mobileNavOverlay = document.getElementById('mobileNavOverlay');
                const mobileNavClose = document.getElementById('mobileNavClose');

                if (!mobileMenuToggle || !mobileNavOverlay || !mobileNavClose) {
                    return;
                }

                mobileMenuToggle.addEventListener('click', () => {
                    mobileMenuToggle.classList.toggle('active');
                    mobileNavOverlay.classList.toggle('active');
                    document.body.style.overflow = mobileNavOverlay.classList.contains('active') ? 'hidden' : 'auto';
                });

                mobileNavClose.addEventListener('click', () => {
                    mobileMenuToggle.classList.remove('active');
                    mobileNavOverlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                });

                mobileNavOverlay.addEventListener('click', (e) => {
                    if (e.target === mobileNavOverlay) {
                        mobileMenuToggle.classList.remove('active');
                        mobileNavOverlay.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });

                const navLinks = mobileNavOverlay.querySelectorAll('.nav a');
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenuToggle.classList.remove('active');
                        mobileNavOverlay.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    });
                });

                window.addEventListener('resize', () => {
                    if (window.innerWidth > 768) {
                        mobileMenuToggle.classList.remove('active');
                        mobileNavOverlay.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            }

            initMobileNavigation();

            //==================================================================




            window.addEventListener('popstate', handlePageLoad);

            handlePageLoad();
        });
    </script>
</body>
</html>
